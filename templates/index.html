{% extends 'base.html' %}

{% block head %}
<title>Watching History</title>
{% endblock %}

{% block body %}
    <h1 style="text-align: center;">Watching History</h1>
    <table border="1" id="watching_history">
        <tr>
            <th>Title</th>
            <th>Season</th>
            <th>Episode</th>
            <th>Progress</th>
        </tr>
        {% for entry in history %}
        <tr>
            <td>{{ entry.title }}</td>
            {% if entry.season != "無" %}
                <td>第{{ entry.value }}{{ entry.season}}</td>
            {% else %}
                <td>無</td>
            {% endif %}
            <td>{{ entry.episode}}</td>
            <td>{{ entry.progress }}</td>
            <td>
                <a href="/delete/{{entry.id}}">Delete</a>
                <br>
                <a href="/update/{{entry.id}}">Update</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <h2>Add New Entry</h2>
    <form action="/" method="POST">
        <label for="title">Title:</label>
        <input type="text" name="title" required><br>

        <label for="season">Season:</label>
        <select name="season" id="seasonSelect">
            <option value="季">季</option>
            <option value="卷">卷</option>
            <option value="無">無</option>
        </select><br>

        <label for="value" id="valueLabel">Value:</label>
        <input type="number" name="value" id="valueInput" value="0" required><br>

        <label for="episode">Episode:</label>
        <input type="number" name="episode" id="episodeInput" required><br>

        <label for="progress">Progress:</label>
        <input type="text" name="progress" required><br>

        <input type="submit" value="新增">
    </form>

    <script>
        const seasonSelect = document.getElementById('seasonSelect');
        const valueLabel = document.getElementById('valueLabel');
        const valueInput = document.getElementById('valueInput');
        const episodeInput = document.getElementById('episodeInput');
    
        seasonSelect.addEventListener('change', function() {
            if (seasonSelect.value === '無') {
                valueLabel.style.visibility = 'hidden'; // Hide the label
                valueInput.style.visibility = 'hidden'; // Hide the input
            } else {
                valueLabel.style.visibility = 'visible'; // Show the label
                valueInput.style.visibility = 'visible'; // Show the input
            }
        });
    
        // Trigger the change event initially in case there's a default value selected
        seasonSelect.dispatchEvent(new Event('change'));
    </script>

{% endblock %}